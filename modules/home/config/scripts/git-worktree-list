#!/usr/bin/env bash
set -euo pipefail

# List git worktrees sorted by most recent commit
# Usage: git-worktree-list

git worktree list --porcelain | awk '
  /^worktree / { path=$2 }
  /^HEAD / { head=$2;
    cmd = "git log -1 --format=%ct " head " 2>/dev/null"
    cmd | getline timestamp
    close(cmd)
    print timestamp "\t" path
  }
' | sort -rn | cut -f2-
